<!DOCTYPE html>
<html>
<head>
    <title>Reset Password</title>
</head>
<body>

<h2>Set New Password</h2>

<form onsubmit="event.preventDefault(); resetPassword();">
    <input type="password" id="newPassword" placeholder="New Password" required>
    <button type="submit">Reset Password</button>
</form>

<div id="errorMessage"></div>

<script src="auth.js"></script>
<script>
async function resetPassword() {
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");
    const password = document.getElementById("newPassword").value;

    if (!password || password.length < 6) {
        document.getElementById("errorMessage").textContent =
            "Password must be at least 6 characters";
        return;
    }

    const response = await fetch(`${window.API_BASE}/auth/reset-password`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, password })
    });

    const data = await response.json();

    if (!response.ok) {
        document.getElementById("errorMessage").textContent =
            data.error || "Reset failed";
        return;
    }

    alert("Password reset successful. Please login.");
    window.location.href = "login.html";
}
</script>

</body>
</html>
